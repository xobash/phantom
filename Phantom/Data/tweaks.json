[
  {
    "id": "disable-telemetry",
    "name": "Disable telemetry",
    "description": "Sets AllowTelemetry policy to 0.",
    "riskTier": "Advanced",
    "scope": "HKLM",
    "reversible": true,
    "detectScript": "$p='HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection'; if((Get-ItemProperty -Path $p -Name AllowTelemetry -ErrorAction Stop).AllowTelemetry -eq 0){'Applied'} else {'Not Applied'}",
    "applyScript": "New-Item -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection' -Force | Out-Null; Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection' -Name AllowTelemetry -Type DWord -Value 0",
    "undoScript": "Remove-ItemProperty -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection' -Name AllowTelemetry -ErrorAction Stop",
    "stateCaptureKeys": ["HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\DataCollection"],
    "destructive": false
  },
  {
    "id": "disable-web-search",
    "name": "Disable Start menu web search",
    "description": "Disables Bing web search in Start.",
    "riskTier": "Basic",
    "scope": "HKCU",
    "reversible": true,
    "detectScript": "$p='HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Search'; if((Get-ItemProperty -Path $p -Name BingSearchEnabled -ErrorAction Stop).BingSearchEnabled -eq 0){'Applied'} else {'Not Applied'}",
    "applyScript": "New-Item -Path 'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Search' -Force | Out-Null; Set-ItemProperty -Path 'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Search' -Name BingSearchEnabled -Type DWord -Value 0",
    "undoScript": "Remove-ItemProperty -Path 'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Search' -Name BingSearchEnabled -ErrorAction Stop",
    "stateCaptureKeys": ["HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Search"],
    "destructive": false
  },
  {
    "id": "show-file-extensions",
    "name": "Show file extensions",
    "description": "Sets Explorer to show known file extensions.",
    "riskTier": "Basic",
    "scope": "HKCU",
    "reversible": true,
    "detectScript": "$p='HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced'; if((Get-ItemProperty -Path $p -Name HideFileExt -ErrorAction Stop).HideFileExt -eq 0){'Applied'} else {'Not Applied'}",
    "applyScript": "Set-ItemProperty -Path 'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced' -Name HideFileExt -Type DWord -Value 0",
    "undoScript": "Set-ItemProperty -Path 'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced' -Name HideFileExt -Type DWord -Value 1",
    "stateCaptureKeys": ["HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced"],
    "destructive": false
  },
  {
    "id": "show-hidden-files",
    "name": "Show hidden files",
    "description": "Shows hidden files in Explorer.",
    "riskTier": "Basic",
    "scope": "HKCU",
    "reversible": true,
    "detectScript": "$p='HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced'; if((Get-ItemProperty -Path $p -Name Hidden -ErrorAction Stop).Hidden -eq 1){'Applied'} else {'Not Applied'}",
    "applyScript": "Set-ItemProperty -Path 'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced' -Name Hidden -Type DWord -Value 1",
    "undoScript": "Set-ItemProperty -Path 'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced' -Name Hidden -Type DWord -Value 2",
    "stateCaptureKeys": ["HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced"],
    "destructive": false
  },
  {
    "id": "disable-consumer-features",
    "name": "Disable Windows consumer features",
    "description": "Stops automatic consumer app suggestions.",
    "riskTier": "Advanced",
    "scope": "HKLM",
    "reversible": true,
    "detectScript": "$p='HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\CloudContent'; if((Get-ItemProperty -Path $p -Name DisableWindowsConsumerFeatures -ErrorAction Stop).DisableWindowsConsumerFeatures -eq 1){'Applied'} else {'Not Applied'}",
    "applyScript": "New-Item -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\CloudContent' -Force | Out-Null; Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\CloudContent' -Name DisableWindowsConsumerFeatures -Type DWord -Value 1",
    "undoScript": "Remove-ItemProperty -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\CloudContent' -Name DisableWindowsConsumerFeatures -ErrorAction Stop",
    "stateCaptureKeys": ["HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\CloudContent"],
    "destructive": false
  },
  {
    "id": "disable-windows-tips",
    "name": "Disable Windows tips",
    "description": "Turns off content delivery tips and suggestions.",
    "riskTier": "Basic",
    "scope": "HKCU",
    "reversible": true,
    "detectScript": "$p='HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\ContentDeliveryManager'; if((Get-ItemProperty -Path $p -Name SubscribedContent-338388Enabled -ErrorAction Stop).'SubscribedContent-338388Enabled' -eq 0){'Applied'} else {'Not Applied'}",
    "applyScript": "Set-ItemProperty -Path 'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\ContentDeliveryManager' -Name SubscribedContent-338388Enabled -Type DWord -Value 0",
    "undoScript": "Set-ItemProperty -Path 'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\ContentDeliveryManager' -Name SubscribedContent-338388Enabled -Type DWord -Value 1",
    "stateCaptureKeys": ["HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\ContentDeliveryManager"],
    "destructive": false
  },
  {
    "id": "disable-gamedvr",
    "name": "Disable Game DVR",
    "description": "Disables Game DVR and background game recording.",
    "riskTier": "Basic",
    "scope": "Both",
    "reversible": true,
    "detectScript": "$p='HKCU:\\System\\GameConfigStore'; if((Get-ItemProperty -Path $p -Name GameDVR_Enabled -ErrorAction Stop).GameDVR_Enabled -eq 0){'Applied'} else {'Not Applied'}",
    "applyScript": "New-Item -Path 'HKCU:\\System\\GameConfigStore' -Force | Out-Null; Set-ItemProperty -Path 'HKCU:\\System\\GameConfigStore' -Name GameDVR_Enabled -Type DWord -Value 0; New-Item -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\GameDVR' -Force | Out-Null; Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\GameDVR' -Name AllowGameDVR -Type DWord -Value 0",
    "undoScript": "Set-ItemProperty -Path 'HKCU:\\System\\GameConfigStore' -Name GameDVR_Enabled -Type DWord -Value 1; Remove-ItemProperty -Path 'HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\GameDVR' -Name AllowGameDVR -ErrorAction Stop",
    "stateCaptureKeys": ["HKCU:\\System\\GameConfigStore", "HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows\\GameDVR"],
    "destructive": false
  },
  {
    "id": "high-performance-plan",
    "name": "Set high performance power plan",
    "description": "Activates high performance power plan.",
    "riskTier": "Advanced",
    "scope": "System",
    "reversible": true,
    "detectScript": "$active=(powercfg /GetActiveScheme); if($active -match '8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c'){'Applied'} else {'Not Applied'}",
    "applyScript": "powercfg /setactive 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c",
    "undoScript": "powercfg /setactive SCHEME_BALANCED",
    "stateCaptureKeys": ["PowerScheme"],
    "destructive": false
  },
  {
    "id": "disable-background-apps",
    "name": "Disable background apps",
    "description": "Prevents UWP apps from running in background.",
    "riskTier": "Advanced",
    "scope": "HKCU",
    "reversible": true,
    "detectScript": "$p='HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\BackgroundAccessApplications'; if((Get-ItemProperty -Path $p -Name GlobalUserDisabled -ErrorAction Stop).GlobalUserDisabled -eq 1){'Applied'} else {'Not Applied'}",
    "applyScript": "New-Item -Path 'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\BackgroundAccessApplications' -Force | Out-Null; Set-ItemProperty -Path 'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\BackgroundAccessApplications' -Name GlobalUserDisabled -Type DWord -Value 1",
    "undoScript": "Set-ItemProperty -Path 'HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\BackgroundAccessApplications' -Name GlobalUserDisabled -Type DWord -Value 0",
    "stateCaptureKeys": ["HKCU:\\Software\\Microsoft\\Windows\\CurrentVersion\\BackgroundAccessApplications"],
    "destructive": false
  },
  {
    "id": "disable-delivery-optimization",
    "name": "Disable Delivery Optimization uploads",
    "description": "Disables peer-to-peer update uploads.",
    "riskTier": "Advanced",
    "scope": "HKLM",
    "reversible": true,
    "detectScript": "$p='HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\DeliveryOptimization\\Config'; if((Get-ItemProperty -Path $p -Name DODownloadMode -ErrorAction Stop).DODownloadMode -eq 0){'Applied'} else {'Not Applied'}",
    "applyScript": "New-Item -Path 'HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\DeliveryOptimization\\Config' -Force | Out-Null; Set-ItemProperty -Path 'HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\DeliveryOptimization\\Config' -Name DODownloadMode -Type DWord -Value 0",
    "undoScript": "Remove-ItemProperty -Path 'HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\DeliveryOptimization\\Config' -Name DODownloadMode -ErrorAction Stop",
    "stateCaptureKeys": ["HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\DeliveryOptimization\\Config"],
    "destructive": false
  },
  {
    "id": "disable-hibernation",
    "name": "Disable hibernation",
    "description": "Turns off hibernate and deletes hiberfil.sys.",
    "riskTier": "Advanced",
    "scope": "System",
    "reversible": true,
    "detectScript": "$o=(powercfg /a); if($o -notmatch 'Hibernate'){ 'Applied' } else { 'Not Applied' }",
    "applyScript": "powercfg /hibernate off",
    "undoScript": "powercfg /hibernate on",
    "stateCaptureKeys": ["Hibernate"],
    "destructive": false
  },
  {
    "id": "disable-smb1",
    "name": "Disable SMBv1",
    "description": "Disables SMBv1 protocol.",
    "riskTier": "Advanced",
    "scope": "System",
    "reversible": true,
    "detectScript": "$v=(Get-SmbServerConfiguration).EnableSMB1Protocol; if($v -eq $false){'Applied'} else {'Not Applied'}",
    "applyScript": "Set-SmbServerConfiguration -EnableSMB1Protocol $false -Force",
    "undoScript": "Set-SmbServerConfiguration -EnableSMB1Protocol $true -Force",
    "stateCaptureKeys": ["SMB1"],
    "destructive": false
  },
  {
    "id": "disable-copilot",
    "name": "Disable Windows Copilot",
    "description": "Disables Copilot policy for current machine.",
    "riskTier": "Advanced",
    "scope": "HKCU",
    "reversible": true,
    "detectScript": "$p='HKCU:\\Software\\Policies\\Microsoft\\Windows\\WindowsCopilot'; if((Get-ItemProperty -Path $p -Name TurnOffWindowsCopilot -ErrorAction Stop).TurnOffWindowsCopilot -eq 1){'Applied'} else {'Not Applied'}",
    "applyScript": "New-Item -Path 'HKCU:\\Software\\Policies\\Microsoft\\Windows\\WindowsCopilot' -Force | Out-Null; Set-ItemProperty -Path 'HKCU:\\Software\\Policies\\Microsoft\\Windows\\WindowsCopilot' -Name TurnOffWindowsCopilot -Type DWord -Value 1",
    "undoScript": "Remove-ItemProperty -Path 'HKCU:\\Software\\Policies\\Microsoft\\Windows\\WindowsCopilot' -Name TurnOffWindowsCopilot -ErrorAction Stop",
    "stateCaptureKeys": ["HKCU:\\Software\\Policies\\Microsoft\\Windows\\WindowsCopilot"],
    "destructive": false
  },
  {
    "id": "remove-onedrive",
    "name": "Remove OneDrive",
    "description": "Uninstalls Microsoft OneDrive.",
    "riskTier": "Dangerous",
    "scope": "System",
    "reversible": false,
    "detectScript": "if(Get-Process OneDrive -ErrorAction Stop){'Installed'} else {'Unknown'}",
    "applyScript": "$exe = Join-Path $env:SystemRoot 'SysWOW64\\OneDriveSetup.exe'; if(!(Test-Path $exe)){ $exe = Join-Path $env:SystemRoot 'System32\\OneDriveSetup.exe'}; if(Test-Path $exe){ Start-Process -FilePath $exe -ArgumentList '/uninstall' -Wait }",
    "undoScript": "Write-Output 'OneDrive reinstall must be manual.'",
    "stateCaptureKeys": [],
    "destructive": true
  },
  {
    "id": "remove-edge",
    "name": "Remove Edge (if removable)",
    "description": "Attempts to uninstall Microsoft Edge package where supported.",
    "riskTier": "Dangerous",
    "scope": "System",
    "reversible": false,
    "detectScript": "if(Get-AppxPackage -Name '*MicrosoftEdge*' -AllUsers -ErrorAction Stop){'Installed'} else {'Not Installed'}",
    "applyScript": "Get-AppxPackage -AllUsers *MicrosoftEdge* | Remove-AppxPackage -ErrorAction Continue",
    "undoScript": "Write-Output 'Edge reinstall must be manual.'",
    "stateCaptureKeys": [],
    "destructive": true
  }
]
